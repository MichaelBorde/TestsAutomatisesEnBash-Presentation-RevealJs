<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Tests automatisés en Bash</title>

        <meta name="description" content="Tests automatisés en Bash">
        <meta name="author" content="Michael">

        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.min.css">
        <link rel="stylesheet" href="css/theme/default.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- If the query includes 'print-pdf', use the PDF print sheet -->
        <script>
            document.write('<link rel="stylesheet" href="css/print/' + ( window.location.search.match(/print-pdf/gi) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">');
        </script>

        <style type="text/css">
            li.important {
                text-decoration: underline;
            }
        </style>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script><![endif]-->
    </head>

    <body>
        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section>
                    <h1>#!</h1>

                    <h3>Tests automatisés en Bash</h3>

                    <p>
                        <small><a href="https://twitter.com/michael_borde">Michael Borde</a> / <a
                                href="http://www.arpinum.fr">www.arpinum.fr</a> / <a href="http://twitter.com/arpinum">@arpinum</a>
                        </small>
                    </p>
                    <img width="10%" height="10%" src="images/logo-arpinum.png" alt="Arpinum"/>
                </section>

                <section>
                    <section>
                        <h2>Le contexte</h2>
                    </section>

                    <section>
                        <p>Et si nous automatisions les opérations répétitives et sensibles ?</p>
                    </section>

                    <section>
                        <h2>Un outil simple : Bash</h2>
                        <img width="60%" height="60%" src="images/cle-a-molette.jpg" alt="Clé à molette"/>
                    </section>

                    <section>
                        <h2>3 fois rien finalement</h2>
                        <ul>
                            <li>Cloner des entrepôts</li>
                            <li>Mettre à jour des sources</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Mais avec un peu d'imagination</h2>
                        <ul>
                            <li>Cloner des entrepôts</li>
                            <li>Mettre à jour des sources</li>
                            <li>Changer de branche</li>
                            <li>Exécuter des commandes</li>
                            <li>Créer des branches</li>
                            <li>Supprimer des branches</li>
                            <li>Importer dans Git</li>
                            <li>Lister les entrepôts à fusionner</li>
                            <li>Préparer la livraison des projets</li>
                            <li>Réaliser la livraison des projets</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Et il y en a pour tout le monde</h2>
                        <img width="60%" height="60%" src="images/equipe-developpement.jpg" alt="Equipe développement"/>

                        <p>Développeurs, administrateurs, livreurs, managers</p>
                    </section>

                    <section>
                        <h2>Dans des contextes multiples</h2>
                        <img width="20%" height="20%" src="images/logo-cygwin.png" alt="Logo Cygwin"/> <img width="20%"
                                                                                                            height="20%"
                                                                                                            src="images/logo-jenkins.png"
                                                                                                            alt="Logo Jenkins"/>

                        <p class="fragment">avec un mode de tests manuels, mais chut!</p>
                    </section>

                    <section>
                        <img width="60%" height="60%" src="images/panneau-stop.jpg" alt="Panneau stop"/>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Il faut tacler la complexité</h2>
                    </section>

                    <section>
                        <p>Et si Bash était un langage de programmation ?</p>
                    </section>

                    <section>
                        <h2>Les outils habituels</h2>
                        <img width="20%" height="20%" src="images/livre-tdd-by-example.jpeg" alt="TDD By Example"/> <img
                            width="20%" height="20%" src="images/livre-xp-explained.jpg" alt="XP Explained"/> <img
                            width="20%" height="20%" src="images/livre-clean-code.jpg" alt="Clean Code"/>
                    </section>

                    <section>
                        <p>Certains vont me dire :</p>
                        <blockquote class="fragment">&ldquo;MER IL ET FOU&rdquo;</blockquote>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Un peu de Clean Code</h2>
                        <ul>
                            <li>clone.sh</li>
                            <li>pull.sh</li>
                            <li>checkout.sh</li>
                            <li>execute.sh</li>
                            <li>creeLaBranche.sh</li>
                            <li>supprimeLaBranche.sh</li>
                            <li>importeDansGit.sh</li>
                            <li>listeEntrepotsAFusionner.sh</li>
                            <li>livre.sh</li>
                        </ul>
                        <ul class="fragment">
                            <li>branche.sh</li>
                            <li>configuration.sh*</li>
                            <li>entrepot.sh</li>
                            <li>git.sh</li>
                            <li>livraison.sh</li>
                            <li>maven.sh</li>
                            <li>nettoyage.sh</li>
                            <li>preparationLivraison.sh</li>
                            <li>systeme.sh</li>
                            <li>tag.sh</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Un équivalent à JUnit?</h2>
                        <img width="30%" height="30%" src="images/junit.jpg" alt="JUnit"/>
                    </section>

                    <section>
                        <p>Bof...</p>
                    </section>

                    <section>
                        <p>Je vais créer mon api de tests automatisés en Bash...</p>
                        <img width="60%" height="60%" src="images/serious-cat.jpg" alt="Serious cat"/>
                    </section>

                    <section>
                        <h2>Les objectifs de l'api</h2>
                        <ul>
                            <li>Ressembler à xUnit,</li>
                            <li>Etre en français,</li>
                            <li>Etre compatible avec l'IC,</li>
                            <li>Favoriser TDD,</li>
                            <li>Respecter la notion de tests unitaires.</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Make them <strong>first</strong></h2>
                        <ul>
                            <li><strong>F</strong>ast</li>
                            <li class="important"><strong>I</strong>solated</li>
                            <li class="important"><strong>R</strong>epeatable</li>
                            <li class="important"><strong>S</strong>elf-verifying</li>
                            <li><strong>T</strong>imely</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Et donc?</h2>
                    </section>

                    <section>
                        <h2>L'exécuteur de test</h2>
                    </section>

                    <section>
                        <h2>Exécuter tous les fichiers de test</h2>
                        <pre><code data-trim class="sh">
function executeur_executeLesFichiersDeTestDansLeRepertoire() {
    local repertoire=${1}
    _initialiseLExecutionDesTests
    _executeTousFichiersDeTest "${repertoire}" *Test.sh
    _afficheLeResultatDesTests
    _retourneUnCodeEnFonctionDuResultatDesTests
}
                        </code></pre>
                    </section>

                    <section>
                        <h2>Exécuter un fichier de test</h2>
                        <pre><code data-trim class="sh">
function _executeLeFichierDeTest() {
    local fichier=${1}
    printf "[Fichier] ${fichier}\n"
    source "${fichier}"
    _executeLeSetupGlobalDuFichier "${fichier}"
    _executeLesTestsDuFichier "${fichier}"
    _executeLeTeardownGlobalDuFichier "${fichier}"
    printf "\n"
}
                        </code></pre>
                    </section>

                    <section>
                        <h2>Exécuter une fonction de test</h2>
                        <pre><code data-trim class="sh">
function _executeLaFonctionAuMilieuDuSetupEtTeardown() {
    local fonctionTest=${1}
    local fichier=${2}
    echo "[Test] ${fonctionTest}"
    ( _executeLeSetupDuFichier "${fichier}" &&
    systeme_evalueDansUnSousShell ${fonctionTest} &&
    _executeLeTeardownDuFichier "${fichier}" )
    _analyseLExecutionDuTest ${fonctionTest} ${?}
}
                        </code></pre>
                    </section>

                    <section>
                        <h2>Les affirmations</h2>
                    </section>

                    <section>
                        <h2>Affirmer l'égalité</h2>
                        <pre><code data-trim class="sh">
function affirmation_affirmeEgalite() {
    local attendu=${1}
    local obtenu=${2}
    if [[ "${attendu}" != "${obtenu}" ]]; then
      _affirmationEnErreur "Obtenu : <${obtenu}>, attendu : <${attendu}>."
    fi
}
                        </code></pre>
                    </section>

                    <section>
                        <h2>Affirmer le succés</h2>
                        <pre><code data-trim class="sh">
function affirmation_affirmeSucces() {
    systeme_evalueDansUnSousShell ${@}
    if (( ${?} != ${SUCCES} )); then
        _affirmationEnErreur "La commande a échoué au lieu de réussir."
    fi
}
                        </code></pre>
                    </section>

                    <section>
                        <h2>Quelques exemples</h2>
                    </section>

                    <section>
                        <h2>Un test unitaire</h2>
                        <pre><code data-trim class="sh">
function recupereBienLaVersionDunPom() {
    local pom="${_ressources}/pom_1.0-SNAPSHOT.xml"

    local version=$(maven_recupereLaVersionDuPom "${pom}")

    affirmation_affirmeEgalite "1.0-SNAPSHOT" "${version}"
}
                        </code></pre>
                    </section>

                    <section>
                        <h2>Un test d'intégration</h2>
                        <pre><code data-trim class="sh">
function ilEstPossibleDeCheckouterUnSeulEntrepot() {
    entrepot_cloneLaBrancheDeLEntrepot "integration" "module-a"

    source "${REPERTOIRE_SCRIPT}/checkout.sh" "master" "module-a"

    local branche=$(_recupereLaBrancheCouranteDeLEntrepot "module-a")
    affirmation_affirmeEgalite "master" "${branche}"
}
                        </code></pre>
                    </section>

                    <section>
                        <figure>
                            <img width="100%" height="100%" src="images/resultat-tests.png" alt="Résultat tests"/>
                            <figcaption>
                                Exemple de sortie console
                            </figcaption>
                        </figure>
                    </section>
                </section>
            </div>

        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.min.js"></script>

        <script>

            Reveal.initialize({
                controls: false,
                progress: true,
                history: true,
                center: true,
                mouseWheel: true,

                keyboard: {
                    37: 'prev', // gauche
                    38: null, // haut
                    39: 'next', // droite
                    40: null // bas
                },

                theme: Reveal.getQueryHash().theme || 'beige',
                transition: Reveal.getQueryHash().transition || 'none',

                dependencies: [
                    { src: 'lib/js/classList.js', condition: function () {
                        return !document.body.classList;
                    } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function () {
                        hljs.initHighlightingOnLoad();
                    } }
                ]
            });
        </script>

    </body>
</html>
