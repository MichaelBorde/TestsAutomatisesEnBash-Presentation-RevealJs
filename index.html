<!doctype html>
<html lang="fr">

    <head>
        <meta charset="utf-8">

        <title>Tests automatisés en Bash</title>

        <meta name="description" content="Tests automatisés en Bash">
        <meta name="author" content="Michael">

        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="reveal.js/css/reveal.min.css">
        <link rel="stylesheet" href="reveal.js/css/theme/default.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

        <link rel="stylesheet" href="css/redefinitions.css">

        <!-- If the query includes 'print-pdf', use the PDF print sheet -->
        <script>
            if (window.location.search.match(/print-pdf/gi)) {
                var link = document.createElement('link');
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = 'reveal.js/css/print/pdf.css';
                document.getElementsByTagName('head')[0].appendChild(link);
            }
        </script>

        <!--[if lt IE 9]>
        <script src="reveal.js/lib/js/html5shiv.js"></script><![endif]-->
    </head>

    <body>
        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section>
                    <img width="100%" height="100%" src="images/ouverture-agile-france.jpg"
                         alt="Ouverture Agile France"/>
                </section>
                <!--<section>--><!--<h1>#!</h1>-->

                <!--<h3>Tests automatisés en Bash</h3>-->

                <!--<p>--><!--<small><a href="https://twitter.com/michael_borde">Michael Borde</a> / <a-->
                <!--href="http://www.arpinum.fr">www.arpinum.fr</a> / <a href="http://twitter.com/arpinum">@arpinum</a>-->
                <!--</small>--><!--</p>-->
                <!--<img width="10%" height="10%" src="images/logo-arpinum.png" alt="Arpinum"/>--><!--</section>-->

                <section>
                    <h2>Le contexte</h2>
                </section>

                <section>
                    <p>Et si nous automatisions les opérations répétitives et sensibles ?</p>
                </section>

                <section>
                    <h2>Un outil simple : Bash</h2>
                    <img width="60%" height="60%" src="images/cle-a-molette.jpg" alt="Clé à molette"/>
                </section>

                <section>
                    <h2>3 fois rien finalement</h2>
                    <ul>
                        <li>Cloner des entrepôts</li>
                        <li>Mettre à jour des sources</li>
                    </ul>
                </section>

                <section>
                    <h2>Mais avec un peu d'imagination</h2>
                    <ul>
                        <li>Cloner des entrepôts</li>
                        <li>Mettre à jour les sources</li>
                        <li>Changer de branche</li>
                        <li>Exécuter des commandes</li>
                        <li>Créer/supprimer des branches</li>
                        <li>Créer/supprimer des jobs Jenkins</li>
                        <li>Lancer des builds Jenkins</li>
                        <li>Importer un nouvel entrepôt</li>
                        <li>Lister les entrepôts à fusionner</li>
                        <li>Préparer la livraison des projets</li>
                        <li>Réaliser la livraison des projets</li>
                        <li>..</li>
                    </ul>
                </section>

                <section>
                    <h2>Et il y en a pour tout le monde</h2>
                    <img width="60%" height="60%" src="images/equipe-developpement.jpg" alt="Equipe développement"/>

                    <p>Développeurs, administrateurs, livreurs, managers</p>
                </section>

                <section>
                    <h2>Dans des contextes multiples</h2>
                    <img width="20%" height="20%" src="images/logo-cygwin.png" alt="Logo Cygwin"/> <img width="20%"
                                                                                                        height="20%"
                                                                                                        src="images/logo-jenkins.png"
                                                                                                        alt="Logo Jenkins"/>
                    <img width="20%" height="20%" src="images/logo-linux.png" alt="Logo Linux"/>

                    <p class="fragment">avec un mode de tests manuels, mais chut!</p>
                </section>

                <section>
                    <h2>Les conseils de Google</h2>
                    <blockquote>
                        If you are writing a script that is more than 100 lines long, you should probably be writing it
                        in Python instead.
                    </blockquote>
                </section>

                <section>
                    <p>En python!</p>
                    <img width="60%" height="60%" src="images/dawson-triste.jpg" alt="Dawson triste"/>
                    <figcaption>
                        <small>© Toute la production de Dawson's Creek</small>
                    </figcaption>
                </section>

                <section>
                    <p>Eh oui, scripter en Bash c'est un peu...</p>
                    <img width="20%" height="20%" src="images/dé.jpg" alt="Dé"/> <img width="20%" height="20%"
                                                                                      src="images/stackoverflow.png"
                                                                                      alt="Stackoverflow"/> <img
                        width="20%" height="20%" src="images/necronomicon.jpg" alt="Necronomicon"/>
                </section>

                <section>
                    <h2>Et pourtant 4796 lignes de Bash ! </h2>
                </section>

                <section>
                    <img width="60%" height="60%" src="images/panneau-stop.jpg" alt="Panneau stop"/>
                </section>

                <section>
                    <h2>Il faut tacler la complexité</h2>
                </section>

                <section>
                    <p>Et si Bash était un langage de programmation ?</p>
                </section>

                <section>
                    <h2>Les outils habituels</h2>
                    <img width="20%" height="20%" src="images/livre-tdd-by-example.jpeg" alt="TDD By Example"/> <img
                        width="20%" height="20%" src="images/livre-xp-explained.jpg" alt="XP Explained"/> <img
                        width="20%" height="20%" src="images/livre-clean-code.jpg" alt="Clean Code"/>
                </section>

                <section>
                    <p>Certains vont me dire :</p>
                    <blockquote class="fragment">&ldquo;MER IL ET FOU&rdquo;</blockquote>
                </section>

                <section>
                    <h2>Clean Code, concrètement?</h2>
                </section>

                <section>
                    <h2>Une programmation modulaire</h2>

                    <ul>
                        <li>clone.sh</li>
                        <li>creeLaBranche.sh</li>
                        <li>importeDansGit.sh</li>
                        <li>livre.sh</li>
                        <li>...</li>
                    </ul>

                    <ul class="fragment">
                        <li>systeme.sh</li>
                        <li>entrepot.sh</li>
                        <li>livraison.sh</li>
                        <li>maven.sh</li>
                        <li>...</li>
                    </ul>
                </section>

                <section>
                    <h2>Un équivalent à JUnit?</h2>
                    <img width="30%" height="30%" src="images/junit.jpg" alt="JUnit"/>
                </section>

                <section>
                    <p>Bof...</p>
                </section>

                <section>
                    <p>Je vais créer mon api de tests automatisés en Bash...</p>
                    <img width="60%" height="60%" src="images/serious-cat.jpg" alt="Serious cat"/>
                </section>

                <section>
                    <h2>Les objectifs de l'api</h2>
                    <ul>
                        <li>Ressembler à xUnit</li>
                        <li>Etre en français</li>
                        <li>Etre compatible avec l'IC</li>
                        <li>Favoriser TDD</li>
                        <li>Respecter la notion de tests unitaires</li>
                    </ul>
                </section>

                <section>
                    <h2>Make them <strong>first</strong></h2>
                    <ul>
                        <li><strong>F</strong>ast</li>
                        <li><strong>I</strong>solated <span class="exclamation">!</span></li>
                        <li><strong>R</strong>epeatable <span class="exclamation">!</span></li>
                        <li><strong>S</strong>elf-verifying <span class="exclamation">!</span></li>
                        <li><strong>T</strong>imely</li>
                    </ul>
                </section>

                <section>
                    <h2>Et donc?</h2>
                </section>

                <section>
                    <h2>L'exécuteur de test</h2>
                </section>

                <section>
                    <h2>Exécuter tous les fichiers de test</h2>
                        <pre><code data-trim class="bash">
function executeur_executeLesFichiersDeTestDansLeRepertoire() {
    local repertoire=$1
    _initialiseLExecutionDesTests
    _executeTousFichiersDeTest "${repertoire}" "*Test.sh"
    _afficheLeResultatDesTests
    _retourneUnCodeEnFonctionDuResultatDesTests
}
                        </code></pre>
                </section>

                <section>
                    <h2>Exécuter un fichier de test</h2>
                        <pre><code data-trim class="bash">
function _executeLeFichierDeTest() {
    local fichier=$1
    source "${fichier}"
    local fonctions=($(_fonctionsPubliquesDansLeFichier "${fichier}"))
    _executeFonctionSiPresente "avantTousLesTests" "${fonctions[@]}"
    _executeTousLesTests "${fonctions[@]}"
    _executeFonctionSiPresente "apresTousLesTests" "${fonctions[@]}"
}
                    </code></pre>
                </section>

                <section>
                    <h2>Exécuter une fonction de test</h2>

                    <pre><code data-trim class="bash">
function _executeLaFonctionAuMilieuDuSetupEtTeardown() {
    local fonction=$1
    shift 1
    (
        _executeFonctionSiPresente "avantChaqueTest" "$@" \
        && ( ${fonction} ) \
        && _executeFonctionSiPresente "apresChaqueTest" "$@"
    )
    _analyseLExecutionDuTest "${fonction}" $?
}
                    </code></pre>
                </section>

                <section>
                    <h2>Quelques affirmations</h2>
                </section>

                <section>
                    <h2>Affirmer l'égalité</h2>
                        <pre><code data-trim class="bash">
function affirmation_affirmeEgalite() {
    local attendu=$1
    local obtenu=$2
    if [[ "${attendu}" != "${obtenu}" ]]; then
      _affirmationEnErreur "Obtenu : <${obtenu}>, attendu : <${attendu}>."
    fi
}
                        </code></pre>
                </section>

                <section>
                    <h2>Affirmer le succés</h2>
                        <pre><code data-trim class="bash">
function affirmation_affirmeSucces() {
    ( $@ )
    if (( $? != 0 )); then
        _affirmationEnErreur "La commande a échoué au lieu de réussir."
    fi
}
                        </code></pre>
                </section>

                <section>
                    <h2>Quelques exemples</h2>
                </section>

                <section>
                    <h2>Un test unitaire</h2>
                        <pre><code data-trim class="bash">
function recupereBienLaVersionDunPom() {
    local pom="${_ressources}/pom_1.0-SNAPSHOT.xml"

    local version=$(maven_recupereLaVersionDuPom "${pom}")

    affirmation_affirmeEgalite "1.0-SNAPSHOT" "${version}"
}
                        </code></pre>
                </section>

                <section>
                    <h2>Un test d'intégration</h2>
                        <pre><code data-trim class="bash">
function ilEstPossibleDeChangerLaBrancheDUnEntrepot() {
    entrepot_cloneLaBrancheDeLEntrepot "integration" "module-a"

    source "${REPERTOIRE_SCRIPT}/checkout.sh" "master" "module-a"

    local branche="$(_recupereLaBrancheCouranteDeLEntrepot "module-a")"
    affirmation_affirmeEgalite "master" "${branche}"
}
                        </code></pre>
                </section>

                <section>
                    <figure>
                        <img width="100%" height="100%" src="images/resultat-tests.png" alt="Résultat tests"/>
                        <figcaption>
                            Exemple de sortie console
                        </figcaption>
                    </figure>
                </section>

                <section>
                    <h2>Reprenons les statistiques</h2>

                    <p>Lignes de code Bash :</p>
                    <ul>
                        <li><strong>Total</strong> : 4796 (100%)</li>
                        <li><strong>Production</strong> : 2797 (58%)</li>
                        <li><strong>Tests</strong> : 1671 (35%)</li>
                        <li><strong>API de tests</strong> : 328 (7%)</li>
                    </ul>
                </section>

                <section>
                    <h2>Et pour le fun</h2>

                    <p>Nombre de tests (temps) :</p>
                    <ul>
                        <li><strong>Tests unitaires</strong> : 91 (13 s)</li>
                        <li><strong>Tests d'intégration</strong> : 109 (10 min)</li>
                    </ul>
                </section>

                <section>
                    <h2>Fin</h2>

                    <p>Pour les curieux :</p>

                    <p><a href="http://github.com/arpinum/shebang_unit" title="shebang_unit">http://github.com/arpinum/shebang_unit</a>
                    </p>
                </section>
            </div>

        </div>

        <script src="reveal.js/lib/js/head.min.js"></script>
        <script src="reveal.js/js/reveal.min.js"></script>

        <script>

            Reveal.initialize({
                controls: false,
                progress: true,
                history: true,
                center: true,
                mouseWheel: true,

                theme: Reveal.getQueryHash().theme || 'beige',
                transition: Reveal.getQueryHash().transition || 'none',

                dependencies: [
                    { src: 'reveal.js/lib/js/classList.js', condition: function () {
                        return !document.body.classList;
                    } },
                    { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function () {
                        hljs.initHighlightingOnLoad();
                    } }
                ]
            });
        </script>

    </body>
</html>
